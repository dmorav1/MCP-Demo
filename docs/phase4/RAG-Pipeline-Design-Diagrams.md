# RAG Pipeline Design Diagrams
# Phase 4: Visual Architecture and Data Flows

**Version:** 1.0  
**Date:** November 8, 2025  
**Status:** Design Document  
**Architect:** Software Architecture Agent

---

## Table of Contents

1. [Overview](#overview)
2. [System Context Diagram](#system-context-diagram)
3. [Component Diagram](#component-diagram)
4. [Sequence Diagrams](#sequence-diagrams)
5. [Data Flow Diagrams](#data-flow-diagrams)
6. [State Diagrams](#state-diagrams)
7. [Deployment Architecture](#deployment-architecture)

---

## Overview

This document provides comprehensive visual representations of the RAG pipeline architecture, including system context, component interactions, data flows, and deployment models.

---

## System Context Diagram

### High-Level System Context

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚                         External Systems                             â”‚
â”‚                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚   OpenAI     â”‚    â”‚  Anthropic   â”‚    â”‚ Local LLM    â”‚        â”‚
â”‚   â”‚     API      â”‚    â”‚     API      â”‚    â”‚  (Ollama)    â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚          â”‚                    â”‚                    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚                    â”‚
           â”‚                    â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚                       MCP Demo System                                â”‚
â”‚                    (Hexagonal Architecture)                          â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Presentation Layer                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚  FastAPI    â”‚             â”‚ MCP Server  â”‚              â”‚   â”‚
â”‚  â”‚  â”‚  REST API   â”‚             â”‚   (stdio)   â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Application Layer                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚   Ingest    â”‚  â”‚   Search    â”‚  â”‚     RAG     â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  Use Case   â”‚  â”‚  Use Case   â”‚  â”‚  Use Case   â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Domain Layer                             â”‚   â”‚
â”‚  â”‚  â€¢ Entities (Conversation, Chunk)                           â”‚   â”‚
â”‚  â”‚  â€¢ Value Objects (Embedding, Query)                         â”‚   â”‚
â”‚  â”‚  â€¢ Port Interfaces (IRAGProvider, ILLMProvider)            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Adapter Layer                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚ Persistence â”‚  â”‚  Embedding  â”‚  â”‚     RAG     â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  Adapters   â”‚  â”‚   Adapters  â”‚  â”‚  Adapters   â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚                    â”‚
           â”‚                    â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚                      Infrastructure Layer                            â”‚
â”‚                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ PostgreSQL   â”‚    â”‚   OpenAI     â”‚    â”‚    Redis     â”‚        â”‚
â”‚   â”‚  + pgvector  â”‚    â”‚  Embeddings  â”‚    â”‚   (Cache)    â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Diagram

### RAG Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RAGService                                   â”‚
â”‚                    (Application Layer)                               â”‚
â”‚                                                                      â”‚
â”‚  â€¢ Orchestrates RAG workflow                                        â”‚
â”‚  â€¢ Coordinates retrieval + generation                               â”‚
â”‚  â€¢ Manages conversation state                                       â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                          â”‚
           â”‚ uses                     â”‚ uses
           â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SearchConversations    â”‚  â”‚     IRAGProvider                       â”‚
â”‚      Use Case           â”‚  â”‚     (Port Interface)                   â”‚
â”‚                         â”‚  â”‚                                         â”‚
â”‚  â€¢ Query embedding      â”‚  â”‚  + generate_answer()                   â”‚
â”‚  â€¢ Vector search        â”‚  â”‚  + stream_answer()                     â”‚
â”‚  â€¢ Relevance filtering  â”‚  â”‚  + manage_conversation()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ implements
                                        â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚    LangChainRAGAdapter                     â”‚
                            â”‚    (Adapter Layer)                         â”‚
                            â”‚                                            â”‚
                            â”‚  â€¢ Wraps LangChain components              â”‚
                            â”‚  â€¢ Implements RAG pipeline                 â”‚
                            â”‚  â€¢ Manages LLM interactions                â”‚
                            â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚            â”‚               â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                      â”‚                            â”‚
                      â”‚ uses                 â”‚ uses                       â”‚ uses
                      â”‚                      â”‚                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   ILLMProvider        â”‚  â”‚ IPromptTemplate  â”‚  â”‚  IMemoryService     â”‚
          â”‚  (Port Interface)     â”‚  â”‚    Manager       â”‚  â”‚  (Port Interface)   â”‚
          â”‚                       â”‚  â”‚ (Port Interface) â”‚  â”‚                     â”‚
          â”‚ + generate()          â”‚  â”‚                  â”‚  â”‚ + save_context()    â”‚
          â”‚ + count_tokens()      â”‚  â”‚ + get_template() â”‚  â”‚ + load_history()    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ + render()       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                  â”‚ implements                                     â”‚ implements
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
      â”‚           â”‚            â”‚                  â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenAI   â”‚ â”‚Anthropicâ”‚ â”‚  Local  â”‚ â”‚  LangChain  â”‚    â”‚ LangChain     â”‚
â”‚   LLM     â”‚ â”‚  LLM   â”‚ â”‚   LLM   â”‚ â”‚   Prompt    â”‚    â”‚  Memory       â”‚
â”‚  Adapter  â”‚ â”‚ Adapterâ”‚ â”‚ Adapter â”‚ â”‚  Adapter    â”‚    â”‚  Adapter      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Supporting Components            â”‚
                    â”‚                                      â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚    RAG      â”‚  â”‚   Token      â”‚ â”‚
                    â”‚  â”‚   Cache     â”‚  â”‚  Optimizer   â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â”‚                                      â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚  Answer     â”‚  â”‚  Citation    â”‚ â”‚
                    â”‚  â”‚  Validator  â”‚  â”‚  Manager     â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â”‚                                      â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚Hallucinationâ”‚  â”‚    Cost      â”‚ â”‚
                    â”‚  â”‚  Detector   â”‚  â”‚   Monitor    â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Sequence Diagrams

### 1. Simple RAG Query Flow

```
User          FastAPI       RAGService      Search         LangChain      LLM
 â”‚              â”‚              â”‚           UseCase         RAGAdapter     Provider
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚â”€POST /askâ”€â”€â”€>â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚â”€ask_question()â”€â”€â”€â”€>         â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚â”€execute()â”€â”€â”€â”€>â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚              â”‚â”€generate_embedding()        â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚              â”‚â”€vector_search()             â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚<â”€search_resultsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚â”€generate_answer()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚â”€generate() â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚<â”€responseâ”€â”€â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚<â”€answer_with_sourcesâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚<â”€resultâ”€â”€â”€â”€â”€â”€â”‚              â”‚                â”‚            â”‚
 â”‚              â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚<â”€200 OKâ”€â”€â”€â”€â”€â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚   {answer,   â”‚              â”‚              â”‚                â”‚            â”‚
 â”‚    sources}  â”‚              â”‚              â”‚                â”‚            â”‚
```

### 2. Conversational RAG with Memory

```
User          RAGService    LangChain     Memory         LLM
                            RAGAdapter    Adapter        Provider
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚â”€Question 1â”€â”€â”€â”€>â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚â”€generate_answer()â”€â”€â”€â”€>    â”‚            â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚â”€load_history()â”€â”€>       â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚<â”€emptyâ”€â”€â”€â”€â”€â”‚            â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€generate() â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€responseâ”€â”€â”€â”€â”€â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚â”€save_context()â”€â”€>       â”‚
 â”‚                â”‚              â”‚  (Q1, A1)   â”‚            â”‚
 â”‚                â”‚<â”€answer_1â”€â”€â”€â”€â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚<â”€Answer 1â”€â”€â”€â”€â”€â”€â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚â”€Question 2â”€â”€â”€â”€>â”‚              â”‚            â”‚            â”‚
 â”‚  (follow-up)   â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚â”€generate_answer()â”€â”€â”€â”€>    â”‚            â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚â”€load_history()â”€â”€>       â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚<â”€historyâ”€â”€â”€â”‚            â”‚
 â”‚                â”‚              â”‚  (Q1, A1)   â”‚            â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€generate() â”‚
 â”‚                â”‚              â”‚  (with      â”‚            â”‚
 â”‚                â”‚              â”‚   history)  â”‚            â”‚
 â”‚                â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€responseâ”€â”€â”€â”€â”€â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚â”€save_context()â”€â”€>       â”‚
 â”‚                â”‚              â”‚  (Q2, A2)   â”‚            â”‚
 â”‚                â”‚<â”€answer_2â”€â”€â”€â”€â”‚            â”‚            â”‚
 â”‚                â”‚              â”‚            â”‚            â”‚
 â”‚<â”€Answer 2â”€â”€â”€â”€â”€â”€â”‚              â”‚            â”‚            â”‚
 â”‚  (contextual)  â”‚              â”‚            â”‚            â”‚
```

### 3. RAG with Caching

```
User          RAGService      Cache        LangChain     LLM
                              Layer        RAGAdapter    Provider
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚â”€Query Aâ”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚â”€check_cache()â”€â”€>            â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚<â”€cache_missâ”€â”€â”‚              â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚â”€generate_answer()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚â”€generate() â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚<â”€responseâ”€â”€â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚<â”€answerâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚â”€cache_result()â”€â”€>           â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚<â”€Answer Aâ”€â”€â”€â”€â”€â”€â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚â”€Query A againâ”€>â”‚              â”‚              â”‚            â”‚
 â”‚  (same query)  â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚â”€check_cache()â”€â”€>            â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚<â”€cache_hitâ”€â”€â”€â”‚              â”‚            â”‚
 â”‚                â”‚  (Answer A)  â”‚              â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚<â”€Answer Aâ”€â”€â”€â”€â”€â”€â”‚              â”‚              â”‚            â”‚
 â”‚  (from cache)  â”‚              â”‚              â”‚            â”‚
 â”‚                â”‚              â”‚              â”‚            â”‚
 â”‚  âš¡ Fast response (no LLM call)              â”‚            â”‚
 â”‚  ğŸ’° Cost savings                             â”‚            â”‚
```

### 4. Multi-Query Retrieval Strategy

```
User          RAGService    QueryExpander  VectorSearch   RAGAdapter
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚â”€Complex Queryâ”€>â”‚              â”‚              â”‚              â”‚
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚                â”‚â”€expand_query()â”€â”€>           â”‚              â”‚
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚                â”‚<â”€query_variationsâ”€          â”‚              â”‚
 â”‚                â”‚  [Q1, Q2, Q3]â”‚              â”‚              â”‚
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€search(Q1)â”€>â”‚              â”‚
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€search(Q2)â”€>â”‚              â”‚
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€search(Q3)â”€>â”‚              â”‚
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€results_1â”€â”€â”€â”€â”€â”‚              â”‚
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€results_2â”€â”€â”€â”€â”€â”‚              â”‚
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€results_3â”€â”€â”€â”€â”€â”‚              â”‚
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚                â”‚â”€merge_and_deduplicate()                    â”‚
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚                â”‚â”€generate_answer()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                â”‚  (merged_results)           â”‚              â”‚
 â”‚                â”‚              â”‚              â”‚              â”‚
 â”‚<â”€Comprehensive Answerâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

---

## Data Flow Diagrams

### RAG Pipeline Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INPUT STAGE                              â”‚
â”‚                                                                  â”‚
â”‚  User Query â”€â”€â”€> Query Validation â”€â”€â”€> Query Enhancement        â”‚
â”‚      â”‚                                         â”‚                 â”‚
â”‚      â”‚                                         â”‚                 â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                        â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RETRIEVAL STAGE                             â”‚
â”‚                                                                  â”‚
â”‚  Query Embedding â”€â”€â”€> Vector Similarity â”€â”€â”€> Ranking            â”‚
â”‚       â”‚                     Search                â”‚              â”‚
â”‚       â”‚                                          â”‚              â”‚
â”‚       â”‚                                          â”‚              â”‚
â”‚   [768 dims]                              [Chunks + Scores]     â”‚
â”‚                                                  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CONTEXT CONSTRUCTION                           â”‚
â”‚                                                                  â”‚
â”‚  Ranked Chunks â”€â”€â”€> Token Counting â”€â”€â”€> Context Selection       â”‚
â”‚                          â”‚                      â”‚                â”‚
â”‚                          â”‚                      â”‚                â”‚
â”‚                     [Token Limit]         [Selected Chunks]      â”‚
â”‚                                                  â”‚                â”‚
â”‚                                                  â–¼                â”‚
â”‚                                           Format Context         â”‚
â”‚                                                  â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GENERATION STAGE                              â”‚
â”‚                                                                  â”‚
â”‚  Context + Query â”€â”€â”€> Prompt Template â”€â”€â”€> LLM Generation       â”‚
â”‚                            â”‚                      â”‚              â”‚
â”‚                            â”‚                      â”‚              â”‚
â”‚                     [Formatted Prompt]       [LLM Response]      â”‚
â”‚                                                  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   POST-PROCESSING STAGE                          â”‚
â”‚                                                                  â”‚
â”‚  LLM Response â”€â”€â”€> Validation â”€â”€â”€> Citation â”€â”€â”€> Cache          â”‚
â”‚                         â”‚           Extraction       â”‚           â”‚
â”‚                         â”‚                â”‚           â”‚           â”‚
â”‚                    [Quality Check]   [Sources]   [Store]         â”‚
â”‚                                                  â”‚              â”‚
â”‚                                                  â–¼              â”‚
â”‚                                            Final Answer          â”‚
â”‚                                             + Metadata           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
                                              User Response
```

### Token Budget Allocation Flow

```
Total Context Window: 8192 tokens
â”‚
â”œâ”€> System Prompt (500 tokens)
â”‚   â””â”€> Role definition
â”‚   â””â”€> Behavior guidelines
â”‚   â””â”€> Output format
â”‚
â”œâ”€> Retrieved Context (3500 tokens max)
â”‚   â”‚
â”‚   â”œâ”€> Chunk 1 (400 tokens) â”€â”€â”€â”
â”‚   â”œâ”€> Chunk 2 (450 tokens)     â”‚
â”‚   â”œâ”€> Chunk 3 (380 tokens)     â”œâ”€> Selected based on:
â”‚   â”œâ”€> Chunk 4 (420 tokens)     â”‚   â€¢ Relevance score
â”‚   â”œâ”€> Chunk 5 (390 tokens)     â”‚   â€¢ Diversity
â”‚   â””â”€> ... (up to limit)    â”€â”€â”€â”€â”˜   â€¢ Token budget
â”‚
â”œâ”€> Conversation History (1000 tokens max)
â”‚   â”‚
â”‚   â”œâ”€> Previous Q1 + A1 (350 tokens)
â”‚   â”œâ”€> Previous Q2 + A2 (420 tokens)
â”‚   â””â”€> Previous Q3 + A3 (230 tokens)
â”‚
â”œâ”€> Current Query (100 tokens)
â”‚   â””â”€> User question
â”‚
â””â”€> Response Buffer (2900 tokens)
    â””â”€> Space for LLM generation
```

---

## State Diagrams

### RAG Request State Machine

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Start  â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Validating  â”‚
                  â”‚    Query     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                    â”‚         â”‚
              Valid â”‚         â”‚ Invalid
                    â”‚         â”‚
                    â–¼         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚Embedding â”‚  â”‚   Error    â”‚
            â”‚Generationâ”‚  â”‚  Response  â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚               â”‚
                 â–¼               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
          â”‚  Searching  â”‚        â”‚
          â”‚   Vectors   â”‚        â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
                 â”‚               â”‚
            â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”          â”‚
            â”‚         â”‚          â”‚
      Found â”‚         â”‚ Not Foundâ”‚
            â”‚         â”‚          â”‚
            â–¼         â–¼          â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
     â”‚Building â”‚  â”‚No Data â”‚    â”‚
     â”‚Context  â”‚  â”‚Responseâ”‚    â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚
          â”‚           â”‚         â”‚
          â–¼           â”‚         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚         â”‚
    â”‚Generatingâ”‚      â”‚         â”‚
    â”‚ Answer   â”‚      â”‚         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚         â”‚
         â”‚            â”‚         â”‚
         â–¼            â”‚         â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚         â”‚
   â”‚Validatingâ”‚       â”‚         â”‚
   â”‚ Answer   â”‚       â”‚         â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚         â”‚
        â”‚             â”‚         â”‚
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”        â”‚         â”‚
   â”‚         â”‚        â”‚         â”‚
Passâ”‚         â”‚Fail   â”‚         â”‚
   â”‚         â”‚        â”‚         â”‚
   â–¼         â–¼        â”‚         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”   â”‚         â”‚
â”‚Caching â”‚ â”‚Retryâ”‚   â”‚         â”‚
â”‚Result  â”‚ â””â”€â”€â”¬â”€â”€â”˜   â”‚         â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚      â”‚         â”‚
    â”‚         â”‚      â”‚         â”‚
    â”‚         â””â”€â”€â”€â”€â”€â”€â”˜         â”‚
    â”‚                          â”‚
    â–¼                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚Complete â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Return â”‚
â”‚  Result â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Conversation Memory State

```
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚     New      â”‚
     â”‚Conversation  â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   Question   â”‚
     â”‚   Received   â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Check Memory â”‚â”€â”€â”€â”€â”€â”€>â”‚   Empty      â”‚
     â”‚   History    â”‚       â”‚   Memory     â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                      â”‚
            â”‚                      â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”               â”‚
     â”‚   History   â”‚               â”‚
     â”‚   Exists    â”‚               â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
            â”‚                      â”‚
            â–¼                      â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
     â”‚  Load and    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚  Summarize   â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   Generate   â”‚
     â”‚    Answer    â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Save Context â”‚â”€â”€â”€â”€â”€â”€>â”‚   Memory     â”‚
     â”‚  (Q + A)     â”‚       â”‚   Updated    â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚Check Memory  â”‚
     â”‚    Size      â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
       â”‚         â”‚
 Under â”‚         â”‚ Over
 Limit â”‚         â”‚ Limit
       â”‚         â”‚
       â–¼         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Keep  â”‚ â”‚ Summarizeâ”‚
  â”‚  Full  â”‚ â”‚  or Pruneâ”‚
  â”‚History â”‚ â”‚  History â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Architecture

### Container Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Docker Compose Deployment                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Application Container                          â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚  â”‚  â”‚   FastAPI   â”‚  â”‚ MCP Server  â”‚  â”‚   Uvicorn   â”‚        â”‚ â”‚
â”‚  â”‚  â”‚   (Port 8000)â”‚ â”‚   (stdio)   â”‚  â”‚   Workers   â”‚        â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚           RAG Service Layer                         â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ LangChain RAG Adapter                            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ LLM Provider Adapters                            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Prompt Template Manager                          â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Memory Manager                                   â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           PostgreSQL Container                              â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚  PostgreSQL 15                           â”‚              â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ pgvector extension                    â”‚              â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Conversation storage                  â”‚              â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Vector embeddings                     â”‚              â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Port: 5432                            â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Redis Container (Optional)                     â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚  Redis                                   â”‚              â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ RAG response caching                  â”‚              â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Session management                    â”‚              â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Port: 6379                            â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

External Services (Not in containers):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ OpenAI API (api.openai.com)                                  â”‚
â”‚  â€¢ Anthropic API (api.anthropic.com)                            â”‚
â”‚  â€¢ Local LLM (Optional Ollama on localhost)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Network Flow

```
                    Internet
                       â”‚
                       â”‚ HTTPS
                       â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Nginx    â”‚
                â”‚ (Reverse   â”‚
                â”‚   Proxy)   â”‚
                â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ HTTP
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   FastAPI Application  â”‚
         â”‚      (Port 8000)       â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
               â”‚            â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                â”‚
     â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PostgreSQLâ”‚                   â”‚   Redis    â”‚
â”‚  (5432)  â”‚                   â”‚   (6379)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Query/Response
     â”‚
     â””â”€â”€â”€â”€â”€â”€> Conversations & Embeddings

External API Calls:
â”‚
â”œâ”€â”€> OpenAI API (HTTPS)
â”œâ”€â”€> Anthropic API (HTTPS)
â””â”€â”€> Local Ollama (HTTP, localhost:11434)
```

### Scalability Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Load Balancer                             â”‚
â”‚                    (Nginx / HAProxy)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚           â”‚           â”‚
            â–¼           â–¼           â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  App     â”‚ â”‚  App     â”‚ â”‚  App     â”‚
     â”‚Instance 1â”‚ â”‚Instance 2â”‚ â”‚Instance 3â”‚
     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
           â”‚            â”‚            â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Redis Cluster   â”‚
              â”‚   (Caching +     â”‚
              â”‚   Session Mgmt)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ PostgreSQL       â”‚
              â”‚   (Primary)      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                â”‚
                â–¼                â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚PostgreSQLâ”‚     â”‚PostgreSQLâ”‚
         â”‚ Replica 1â”‚     â”‚ Replica 2â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Appendix

### Diagram Legend

**Boxes:**
- `â”Œâ”€â”€â”€â”€â”€â”€â”` = Component/Service
- `â”‚      â”‚` = Container
- Rounded corners = External system

**Arrows:**
- `â”€â”€>` = Synchronous call
- `-->` = Asynchronous message
- `â•â•â•>` = Data flow
- `- - >` = Optional dependency

**States:**
- Rectangle = Processing state
- Diamond = Decision point
- Circle = Start/End state

---

**Document Status**: Complete  
**Next Document**: Prompt Template Library  
**Owner**: Software Architecture Agent
